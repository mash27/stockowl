<h3 class="investor-show-align">Portfolio Profile</h3>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<div class="container-custom">
      <%= image_tag @investor.photo, class: "investor-photo" %>
      <table class="profile-table">
        <tbody>
          <tr>
            <td>
              <strong>Manager:</strong>
            </td>
            <td>
              <%= @investor.first_name %> <%= @investor.last_name %>
            </td>
          </tr>
          <tr>
            <td>
              <strong>Fund Name:</strong>
            </td>
            <td>
             <%= @investor.fund_name %>
           </td>
         </tr>
         <tr>
          <td>
            <strong>Portfolio Value:</strong>
          </td>
          <td>
            <%= @investor.portfolio_value %>
          </td>
        </tr>
      </tbody>
    </table>
    <%= render "pie_chart", sectors_pie_chart_data: @sectors_pie_chart_data %>
</div>

<table class="highlighter stocks">
  <thead>
    <tr>
      <th class="text-left">
        <%= link_to investor_path(@investor, sort: (params[:sort] == 'ticker-asc' ? 'ticker-desc' : 'ticker-asc')), class: "spaced" do %>
        <p>
        Ticker
        </p>
        <i class="fa fa-chevron-down"></i>
        <% end %>
      </th>
      <th class="text-left">
      <span class="spaced">
        Company
        </span>
      </th>
      <th class="text-left">
        <%= link_to investor_path(@investor, sort: (params[:sort] == 'sector-asc' ? 'sector-desc' : 'sector-asc')), class: "spaced" do %>
        <p>
        Sector
        </p>
        <i class="fa fa-chevron-down"></i>
        <% end %>
      </th>
      <th class="text-right">
      <span class="spaced">
        Current Price
        </span>
      </th>
      <th class="text-right">
        <%= link_to investor_path(@investor, sort: (params[:sort] == 'mcap-desc' ? 'mcap-asc' : 'mcap-desc')), class: "spaced header-small-font" do %>
        <p>
        Market Cap  ($ Mil)
                </p>
                <i class="fa fa-chevron-down"></i>
        <% end %>
      </th>
      <th class="text-right">
      <span class="spaced">
        Shared
      </span>
      </th>
      <th class="text-right">
            <span class="spaced">
        Value ($1000)
      </span>
      </th>
      <th class="text-right">
        <%= link_to investor_path(@investor, sort: (params[:sort] == 'weight-desc' ? 'weight-asc' : 'weight-desc')), class: "spaced" do %>
        <p>
        % Weight
                </p>
                <i class="fa fa-chevron-down"></i>
        <% end %>
      </th>
      <th class="text-right">
        <%= link_to investor_path(@investor, sort: (params[:sort] == 'share-change-desc' ? 'share-change-asc' : 'share-change-desc')), class: "spaced header-small-font" do %>
        <p>
        % Share Change from last Q
                </p>
                <i class="fa fa-chevron-down"></i>
        <% end %>
      </th>
      <th class="text-right">
        <%= link_to investor_path(@investor, sort: (params[:sort] == 'sharesout-desc' ? 'sharesout-asc' : 'sharesout-desc')), class: "spaced" do %>
        <p>
        % Shares Outstanding
                </p>
                <i class="fa fa-chevron-down"></i>
        <% end %>
      </th>
      <th class="text-right">
       <%= link_to investor_path(@investor, sort: (params[:sort] == '3mchange-desc' ? '3mchange-asc' : '3mchange-desc')), class: "spaced" do %>
       <p>
       3M % Change
               </p>
               <i class="fa fa-chevron-down"></i>
       <% end %>
     </th>
     <th class="text-right">
       <%= link_to investor_path(@investor, sort: (params[:sort] == 'ytdchange-desc' ? 'ytdchange-asc' : 'ytdchange-desc')), class: "spaced" do %>
       <p>
       YTD % Change
               </p>
               <i class="fa fa-chevron-down"></i>
       <% end %>
     </th>
   </tr>
 </thead>
 <tbody>
  <% @investor_stocks.each do |investor_stock| %>
  <tr>
    <%= render partial: "investor_stock", locals: { investor_stock: investor_stock } %>

    <td>
      <button class="waves-effect waves-light btn modal-trigger brand-blue" href="#modal<%= investor_stock.stock.id %>" onclick="drawVisualizationForModal<%= investor_stock.stock.id %>()">History</button>
    </td>
  </tr>
  <% end %>
</tbody>
</table>

<% @investor.investor_stocks.each_with_index do |investor_stock, index| %>
<!-- Modal Structure -->
<div id="modal<%= investor_stock.stock.id %>" class="modal bottom-sheet">
  <div class="modal-content">
    <div class="row">
      <div class="col-xs-6">
        <h4><%= investor_stock.stock.ticker %> ($<%= investor_stock.stock.current_price %>) - <%= @investor.first_name %> <%= @investor.last_name %> holding history</h4>
        <%= render partial: "holding_history", locals: { investor_stock_quarters: investor_stock.investor_stock_quarters } %>
      </div>
      <div class="col-xs-6">
        <%= render partial: "combo_chart", locals: { quarters_combo_chart_data: @quarters_combo_chart_data[index], stock_id: investor_stock.stock.id} %>
      </div>
    </div>
  </div>
  <!-- <div class="modal-footer">
    <a href="#" class="modal-action modal-close waves-effect waves-green btn-flat">Agree</a>
  </div> -->
</div>
<% end %>
